#########################
#  MPV Master Config    #
#########################

# GPU API and Processing
gpu-api=vulkan                    # Use Vulkan for GTX 1650 Ti
hwdec=auto-copy                   # Enable best hardware decoding while maintaining quality
vo=gpu-next                       # Use the next-gen mpv render
profile=high-quality              # High quality profile

#########################
#  Processing Options   #
#########################

# Video Processing
profile-desc="Maximum quality settings"
profile-cond=get('width', -math.huge) >= 1080
profile-restore=copy-equal

# Deband (Reduce color banding) - Higher quality settings
deband=yes
deband-iterations=4               # Higher = Better quality
deband-threshold=35               # Lower = Keep more detail
deband-range=16                   # Higher = Smoother gradient
deband-grain=4                    # Inject grain to mask artifacts

# Denoise - Conservative to preserve quality
denoise=no                        # Disable by default to preserve quality
denoise-scale=0                   # Minimum denoise when enabled

#########################
#  Scaling & Shaders    #
#########################

# Upscaling - Highest quality
glsl-shader="~~/shaders/FSRCNNX_x2_8-0-4-1.glsl"  # AI upscaling shader
scale=ewa_lanczossharp            # Highest quality scaling
scale-blur=0.981251               # Reduce ringing while maintaining sharpness

# Downscaling - Highest quality
dscale=mitchell                   # High quality downscaling
correct-downscaling=yes           # Improve downscaling quality
linear-downscaling=no             # Better quality downscale
sigmoid-downscaling=yes           # Enhance color accuracy

# Chroma - Maximum quality
glsl-shader="~~/shaders/CfL_Prediction.glsl"  # Better chroma upscaling
cscale=ewa_lanczossharp           # Best chroma scaling
sigmoid-upscaling=yes             # Better color accuracy

#########################
#  Color Management     #
#########################

# HDR/Color Settings
gamut-mapping-mode=desaturate     # Better color handling
tone-mapping=bt.2446a             # High quality HDR tone mapping
tone-mapping-max-boost=1.0        # Prevent overexposure
hdr-compute-peak=yes              # Dynamic HDR analysis
target-colorspace-hint=yes        # Better color accuracy

#########################
# Audio Configuration   #
#########################

# Audio Settings
audio-normalize-downmix=yes       # Normalize multichannel audio
audio-resample-cutoff=0.91        # Better resampling quality
audio-resample-linear=no          # Use sinc resampling
audio-resample-filter-size=32     # Larger filter for better quality
audio-channels=auto-safe          # Automatically select best channel layout
volume-max=200                    # Maximum volume
audio-pitch-correction=yes        # Better audio pitch correction
audio-stream-silence=yes          # Fix audio popping

#######################
#      Cache          #
#######################

demuxer-max-bytes=1024MiB         # Increase cache size for better playback
demuxer-max-back-bytes=300MiB     # Larger backward cache
cache=yes
cache-secs=600                    # Cache more for smoother playback
cache-pause=no                    # Don't pause when cache is low
cache-pause-wait=10               # Wait before pausing playback

# Network Specific
[protocol.http]
hls-bitrate=max                   # Maximum quality for HLS
force-seekable=yes                # Allow seeking in streams
cache=yes
cache-secs=600                    # Large cache for streams
demuxer-max-bytes=1024MiB         # Maximum cache size
demuxer-max-back-bytes=300MiB     # Maximum backward cache

[protocol.https]
profile=protocol.http

[protocol.ytdl]
profile=protocol.http

#########################
#      General          #
#########################

keep-open=always                  # Don't close player after playback
save-position-on-quit=no         # Save position on quit
watch-later-options=start,vid,aid,sid  # Save these properties

# Language Preferences
alang=jpn,jp,eng,en,enUS,en-US    # Audio language priority
slang=eng,en,und,de,ger,jp,jap    # Subtitle language priority

# Window Position and Size
autofit=85%x85%
cursor-autohide=100

#########################
#    Screenshots        #
#########################

screenshot-format=png
screenshot-png-compression=0       # No compression for best quality
screenshot-tag-colorspace=yes
screenshot-high-bit-depth=yes
screenshot-template="%x/Screens/Screenshot-%F-T%wH.%wM.%wS.%wT-F%{estimated-frame-number}"
